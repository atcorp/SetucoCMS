<?php
/**
 * ファイルのアップロードや編集、一覧表示の画面
 *
 * LICENSE: ライセンスに関する情報
 *
 * @category   Setuco
 * @package    Admin
 * @subpackage View_Script_Media
 * @license    http://www.opensource.org/licenses/gpl-2.0.php GNU General Public License, version 2
 * @copyright  Copyright (c) 2010 SetucoCMS Project.(http://sourceforge.jp/projects/setucocms)
 * @link
 * @version
 * @since      File available since Release 0.1.0
 * @param
 * @author     akitsukada
 */
?>
<?php $this->headScript()->captureStart() ?>
function addElement() {
    var element = document.createElement('dd');
    element.innerHTML = '<input type="file" name="upload_img" id="upload_img" size="55" />';

    var objBody = document.getElementById("inputArea");
    objBody.appendChild(element);
}
<?php $this->headScript()->captureEnd() ?>

<!-- topicPath START -->
<div id="topicPath">
    <p><a href="<?php echo $this->baseUrl('/admin') ?>">トップ</a><img src="<?php echo $this->baseUrl('/images/topicPath.gif') ?>" width="6" height="11" alt="の中の" /></p>
    <p>ファイルの追加・編集・削除</p>
</div>
<!-- topicpath END -->

<!-- section START -->
<div class="section">
    <div class="topichAreaL">
        <div class="topichAreaR">
            <div class="topichArea">
                <h3><img src="<?php echo $this->baseUrl('/images/h_file.jpg') ?>"
                    width="193" height="18" alt="ファイルの追加・編集・削除" /></h3>
            </div>
        </div>
    </div>
    <?php if (count($this->flashMessage)): ?>
    <div id='messageArea'>
        <?php foreach ($this->flashMessage as $message): ?>
            <p><?php echo $message ?></p>
        <?php endforeach ?>
        <p><a href="javascript:void(0)" onclick="hideFlashMessage()">OK</a></p>
    </div>
    <?php endif ?>
    <form action="<?php echo $this->uploadForm->getAction() ?>" method="post" ENCTYPE="MULTIPART/FORM-DATA">
        <div class="default">
          <?php if (isset($this->uploadForm)): ?>
              <p><?php echo $this->uploadForm->getElement('upload_img') ?></p>
              <p><a href="#" onclick="addElement()">ファイル選択欄を増やす</a></p><?php // @todo 未対応 ?>
              <p><span class="attentionMessage">※アップロードできるファイルは、1ファイル <?php echo $this->maxFileSize ?> KBまでです。</span></p>
              <p><?php echo $this->uploadForm->getElement('up') ?></p>
          <?php else: ?>
              <?php foreach($this->dirErrors as $direrr): ?>
              <p><span class="attentionMessage"><?php echo $direrr ?></span></p>
              <?php endforeach ?>
              <p><span class="attentionMessage">アップロード先フォルダの設定を確認してください。</span></p>
          <?php endif ?>
        </div>
    </form>
    <form action="<?php echo $this->searchForm->getAction() ?>" method="post" name="searchForm">
        <div class="default">
            <p><?php echo $this->searchForm->getElement('fileType') ?></p>
            <p><?php echo $this->searchForm->getElement('search') ?></p>
        </div>
    </form>
    <table summary="ファイル一覧の表です。編集ボタンから、ファイルの編集ができます。削除ボタンから削除ができます。サムネイルを押すとファイルを表示します。" cellpadding="0" cellspacing="0">
        <colgroup>
            <col width="20%" />
            <col width="30%" />
            <col width="18%" />
            <col width="18%" />
            <col width="7%" />
            <col width="7%" />
        </colgroup>
        <thead>
            <tr>
                <th scope="col" id="tableFirst">表示</th>
                <th scope="col">ファイル
                    <a href="<?php echo $this->baseUrl('/admin/media/index') . '/page/1/type/' . $this->condition['type'] . '/sort/name/order/desc' ?>"><img src="<?php echo $this->baseUrl('images/btn_sort_descending.gif') ?>" width="15" height="15" alt="降順に並び替え" /></a>
                    <a href="<?php echo $this->baseUrl('/admin/media/index') . '/page/1/type/' . $this->condition['type'] . '/sort/name/order/asc' ?>"><img src="<?php echo $this->baseUrl('images/btn_sort_ascending.gif') ?>" width="15" height="15" alt="昇順に並び替え" /></a>
                </th>
                <th scope="col">更新日
                    <a href="<?php echo $this->baseUrl('/admin/media/index') . '/page/1/type/' . $this->condition['type'] . '/sort/update_date/order/desc' ?>"><img src="<?php echo $this->baseUrl('images/btn_sort_descending.gif') ?>" width="15" height="15" alt="降順に並び替え" /></a>
                    <a href="<?php echo $this->baseUrl('/admin/media/index') . '/page/1/type/' . $this->condition['type'] . '/sort/update_date/order/asc' ?>"><img src="<?php echo $this->baseUrl('images/btn_sort_ascending.gif') ?>" width="15" height="15" alt="昇順に並び替え" /></a>
                </th>
                <th scope="col">アップロード日
                    <a href="<?php echo $this->baseUrl('/admin/media/index') . '/page/1/type/' . $this->condition['type'] . '/sort/create_date/order/desc' ?>">
                        <img src="<?php echo $this->baseUrl('images/btn_sort_descending.gif') ?>" width="15" height="15" alt="降順に並び替え" />
                    </a>
                    <a href="<?php echo $this->baseUrl('/admin/media/index') . '/page/1/type/' . $this->condition['type'] . '/sort/create_date/order/asc'; ?>"><img src="<?php echo $this->baseUrl('images/btn_sort_ascending.gif') ?>" width="15" height="15" alt="昇順に並び替え" /></a>
                </th>
                <th scope="col">編集</th>
                <th scope="col">削除</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($this->mediaData as $cnt => $media): ?>
            <tr <?php echo $cnt % 2 == 0 ? 'class="checkG"' : '' ?>>
                <td class="thumb">
                    <a href="#" onclick=""> <!-- そのファイルを開く？プレビューをJSで表示？  -->
                        <img src="<?php echo $this->baseUrl($media['thumbUrl']) ?>" width="<?php echo $media['thumbWidth'] ?>" height="auto" alt="<?php echo $media['type'] ?> ファイル" />
                    </a>
                </td>
                <td><?php echo $media['name'] ?>[<?php echo $media['type'] ?>]</td>
                <td><?php echo $media['create_date'] ?></td>
                <td><?php echo $media['update_date'] ?></td>
                <td>
                    <a href="<?php echo $this->baseUrl('/admin/media/form/id/' . $media['id']) ?>">
                        <img src="<?php echo $this->baseUrl('/images/btn_edit.png') ?>" alt='編集' width='27' height='27' />
                    </a>
                </td>
                <td>
                    <a href="#" onclick="if (confirm('ファイル <?php echo $media['name'] ?> を削除しますか？')) { location.href = '<?php echo $this->baseUrl('/admin/media/delete/id/' . $media['id']); ?>'; }">
                        <img src="<?php echo $this->baseUrl('/images/btn_delete.png') ?>" alt='削除' width='27' height='27' />
                    </a>
                </td>
            </tr>            
            <?php endforeach ?>
        </tbody>
    </table>
    <div id="pageNav"><?php echo $this->paginator //ページャーの表示 ?></div>
</div>
<!-- section END -->
